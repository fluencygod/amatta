services:
  backend:
    # Mount local TLS certs generated by scripts/tls/mkcert-local.sh
    volumes:
      - ./apps/backend/certs:/app/certs:ro
    # Override command to enable HTTPS via uvicorn SSL flags
    command: >
      sh -c "python scripts/wait_for_db.py && alembic upgrade head && \
      uvicorn app.main:app --host 0.0.0.0 --port 8000 \
      --ssl-certfile /app/certs/localhost.pem \
      --ssl-keyfile /app/certs/localhost-key.pem"
    environment:
      # Open CORS for testing; credentials not needed for analytics
      - CORS_ALLOWED_ORIGINS=["*"]
      - CORS_ALLOW_CREDENTIALS=false

networks:
  default:
    name: news_net
    external: true

